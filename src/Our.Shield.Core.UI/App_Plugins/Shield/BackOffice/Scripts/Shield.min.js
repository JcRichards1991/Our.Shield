angular.module("umbraco").controller("Shield.Controllers.Dashboard",["$scope","dashboardResource","localizationService",function(n,t,i){var r=this;angular.extend(r,{loading:!0,name:"",tabs:[],init:function(){i.localize("sections_Shield").then(function(n){r.name=n});t.getDashboard("Shield").then(function(n){r.tabs=n;r.tabs&&r.tabs.length>0&&(r.tabs[0].active=!0);r.loading=!1})},changeTab:function(n){r.tabs.forEach(function(n){n.active=!1});n.active=!0}})}]);angular.module("umbraco").controller("Shield.Controllers.EnvironmentsDashboard",["$scope","$location","shieldResource",function(n,t,i){var r=this;angular.extend(r,{loading:!0,environments:[],init:function(){i.getEnvironments().then(function(n){r.environments=n;r.loading=!1})},addEnvironment:function(){t.path("/settings/shield/CreateEnvironment")},editEnvironment:function(n){t.path("/settings/shield/environment/"+n)},sortEnvironments:function(){}})}]);angular.module("umbraco").controller("Shield.Controllers.JournalDashboard",["$scope","$routeParams","$location","listViewHelper","shieldResource",function(n,t,i,r,u){var f=this;angular.extend(f,{id:t.id,method:t.method,loading:!0,items:[],totalPages:1,pageNumber:1,type:null,options:{orderBy:"datestamp",orderDirection:"desc"},columns:[{id:0,name:"Date",alias:"datestamp",allowSorting:!0,show:!0},{id:1,name:"Environment",alias:"environment",allowSorting:!0,show:!0},{id:2,name:"App",alias:"app",allowSorting:!1,show:!0},{id:3,name:"Message",alias:"message",allowSorting:!1,show:!0}],init:function(){t.method===undefined&&(f.id="",f.method="Environments");f.getListing()},editEnvironment:function(n){i.path("/shield/shield/environment/"+n)},editApp:function(n){i.path("/shield/shield/app/"+n)},nextPage:function(n){f.pageNumber=n;f.getListing()},previousPage:function(n){f.pageNumber=n;f.getListing()},gotoPage:function(n){f.pageNumber=n;f.getListing()},isSortDirection:function(n,t){return r.setSortingDirection(n,t,f.options)},sort:function(n){f.options.orderBySystemField=!1;r.setSorting(n,allow,f.options);f.getListing()},getListing:function(){f.loading=!0;u.getJournals(f.method,f.id,f.pageNumber,f.options.orderBy,f.options.orderDirection).then(function(){f.items=[];f.totalPages=0;f.loading=!1})}})}]);angular.module("umbraco").controller("Shield.Editors.Dialogs.EditException",["$scope",function(n){var t=this;angular.extend(t,{exception:n.dialogData,buttonKey:"",init:function(){t.buttonKey="general_"+(t.exception.fromIpAddress===""?"add":"update")},close:n.close,submit:function(){n.submit(t.exception)}})}]);angular.module("umbraco.directives").directive("shieldApp",["$compile","$templateCache","$http",function(n,t,i){return{restrict:"E",scope:{view:"=",configuration:"="},link:function(r,u){if(r.view){var f=t.get(r.view);f?(u.html(f),n(u.contents())(r)):i.get(r.view).then(function(i){t.put(r.view,i.data);u.html(i.data);n(u.contents())(r)})}}}}]);angular.module("umbraco.directives").directive("shieldConvertToNumber",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){return parseInt(n,10)});r.$formatters.push(function(n){return""+n})}}}]);angular.module("umbraco.directives").directive("shieldAddToForm",[function(){return{restrict:"A",require:["ngModel","^form"],link:function(n,t,i,r){var u=r[0],f=r[1];f.$removeControl(u);u.$name=i.name;f.$addControl(u)}}}]);angular.module("umbraco.directives").directive("shieldIpaddressvalid",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){if(n===""||n===undefined)return r.$setValidity("shieldIpaddressvalid",!0),n;return r.$setValidity("shieldIpaddressvalid",/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(n)),n})}}}]);angular.module("umbraco.directives").directive("shieldIpAccessControl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/IpAccessControl.html",scope:{model:"="}}}]);angular.module("umbraco.directives").directive("shieldIpAccessControlRanges",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/IpAccessControlRanges.html",scope:{exceptions:"="},controller:["$scope","localizationService","dialogService",function(n,t,i){angular.extend(n,{add:function(){n.openDialog(-1)},edit:function(t){n.openDialog(t)},openDialog:function(t){var r;r=t===-1?{fromIpAddress:"",toIpAddress:"",description:"",ipAddressType:0}:angular.copy(n.exceptions[t]);i.open({template:"../App_Plugins/Shield/Backoffice/Views/Dialogs/EditIpException.html",dialogData:r,callback:function(i){t===-1?n.exceptions.push(i):n.exceptions[t]=i}})},remove:function(i){var r=n.exceptions[i],u;r.value!==""?(u=r.value,r.description!==""&&(u+=" - "+r.description),t.localize("Shield.Properties.IpAccessControl.Messages_ConfirmRemoveIp").then(function(t){confirm(t+u)&&n.exceptions.splice(i,1)})):n.exceptions.splice(i,1)}})}]}}]);angular.module("umbraco.directives").directive("shieldTransferUrl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/TransferUrl.html?version=1.1.0",scope:{model:"="}}}]);angular.module("umbraco.directives").directive("shieldUmbracoUrl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/UmbracoUrl.html",scope:{model:"="},link:function(n){n.model===null&&(n.model={type:0,value:""});switch(n.model.type){case 0:n.model.urlValue=n.model.value;break;case 1:n.model.xpathValue=n.model.value;break;case 2:n.model.mntpValue=n.model.value||""}angular.extend(n.model,{contentPickerProperty:{view:"contentpicker",alias:"contentPicker",currentNode:{path:"-1"},config:{multiPicker:"0",entityType:"Document",startNode:{query:"",type:"content",id:"-1"},filter:"",minNumber:1,maxNumber:1},value:n.model.mntpValue}});n.$on("formSubmitting",function(){switch(n.model.type){case 0:n.model.value=n.model.urlValue;break;case 1:n.model.value=n.model.xpathValue;break;case 2:n.model.value=n.model.contentPickerProperty.value}})}}}]);angular.module("umbraco").controller("shield.editors.environment.edit",["$scope","$routeParams","$location","$timeout","$route","notificationsService","localizationService","navigationService","shieldResource",function(n,t,i,r,u,f,e,o,s){var h=this;angular.extend(h,{environmentKey:t.id,editing:t.edit==="true",loading:!0,environment:{},path:[],ancestors:null,apps:[],tabs:[{id:"0",label:"Apps",view:"/App_Plugins/Shield/BackOffice/Views/AppListing.html?version=1.1.3",active:!0},{id:"1",label:"Settings",view:"/App_Plugins/Shield/BackOffice/Views/EditEnvironment.html?version=1.1.3",active:!1},{id:"2",label:"Journal",view:"/App_Plugins/Shield/BackOffice/Dashboards/Journal.html?version=1.1.3",active:!1}],button:{label:"Update",labelKey:"general_update",state:"init"},init:function(){s.getEnvironment(h.environmentKey).then(function(n){h.environment=n;h.environment.id===1&&h.editing?h.cancelEditing():(h.path=["-1",h.environment.key],h.ancestors=[{id:h.environment.key,name:h.environment.name}]);h.environment.id!==1&&(h.environment.domains===null||h.environment.domains.length===0)&&(h.environment.domains=[{id:0,name:"",umbracoDomainId:null,environmentId:h.environment.id}]);r(function(){o.syncTree({tree:"shield",path:h.path,forceReload:!0,activate:!0});h.loading=!1},1e3)})},editApp:function(n){i.path("/shield/shield/App/"+n)},edit:function(){i.search("edit","true")},cancelEditing:function(){i.search("edit")},save:function(t){if(!t.overlayForm){if(h.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),t.$invalid){h.button.state="error";angular.element(event.target).addClass("show-validation");e.localize("Shield.General_SaveEnvironmentInvalid").then(function(n){f.error(n)});return}t.$setPristine();s.postEnvironment(h.environment).then(function(n){n===!0||n==="true"?(e.localize("Shield.General_SaveEnvironmentSuccess").then(function(n){f.success(n)}),o.syncTree({tree:"shield",path:h.path,forceReload:!0,activate:!0}),h.cancelEditing()):(h.button.state="error",e.localize("Shield.General_SaveEnvironmentError").then(function(n){f.error(n)}))})}}})}]);angular.module("umbraco").controller("shield.editors.environment.create",["$scope","$location","localizationService","navigationService","notificationsService","shieldResource",function(n,t,i,r,u,f){var e=this;angular.extend(e,{button:{label:"Create",labelKey:"general_create",state:"init"},environment:{icon:"",name:"",domains:[{id:0,name:"",umbracoDomainId:null,environmentId:0}],enable:!1,continueProcessing:!1},loading:!0,init:function(){e.loading=!1},save:function(o){if(!o.overlayForm){if(e.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),o.$invalid){e.button.state="error";angular.element(event.target).addClass("show-validation");i.localize("Shield.General_CreateEnvironmentInvalid").then(function(n){u.error(n)});return}o.$setPristine();f.postEnvironment(e.environment).then(function(n){n===!0||n==="true"?(i.localize("Shield.General_CreateEnvironmentSuccess").then(function(n){u.success(n)}),r.syncTree({tree:"shield",path:["-1","-21"],forceReload:!0,activate:!0}),t.path("/shield")):(e.button.state="error",i.localize("Shield.General_CreateEnvironmentError").then(function(n){u.error(n)}))})}}})}]);angular.module("umbraco").controller("shield.editors.app.edit",["$scope","$routeParams","$timeout","$route","notificationsService","localizationService","navigationService","shieldResource",function(n,t,i,r,u,f,e,o){var s=this;angular.extend(s,{appKey:t.id,loading:!0,app:{},path:[],ancestors:[],button:{label:"Update",labelKey:"general_update",state:"init"},init:function(){o.getApp(s.appKey).then(function(n){s.app=n;s.path=["-1",s.app.environment.key,s.appKey];s.ancestors=[{id:s.app.environment.key,name:s.app.environment.name},{id:s.appKey,name:s.app.name}];i(function(){e.syncTree({tree:"shield",path:s.path,forceReload:!0,activate:!0});s.loading=!1})})},save:function(){if(s.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),n.appForm.$invalid){angular.element(event.target).addClass("show-validation");f.localize("Shield.General_SaveConfigurationInvalid").then(function(n){u.error(n)});s.button.state="error";return}n.appForm.$setPristine();o.postConfiguration(s.appKey,s.app.configuration).then(function(n){n===!0||n==="true"?(f.localize("Shield.General_SaveConfigurationSuccess").then(function(n){u.success(n)}),e.syncTree({tree:"shield",path:s.path,forceReload:!0,activate:!0}),r.reload()):(f.localize("Shield.General_SaveConfigurationError").then(function(n){u.error(n)}),s.button.state="error")})}})}]);angular.module("umbraco.resources").factory("shieldResourceHelper",["$http","$q",function(n,t){return{"delete":function(i){var r=t.defer();return n({method:"DELETE",url:i,headers:{"Content-Type":"application/json"}}).then(function(n){return r.resolve(n.data)},function(n){return console.log(n),r.resolve(!1)}),r.promise},get:function(i,r){var u=t.defer();return r=r||{},n.get(i,{params:r}).then(function(n){return u.resolve(n.data)},function(n){return console.log(n),u.resolve(!1)}),u.promise},post:function(i,r){var u=t.defer();return n({method:"POST",url:i,data:JSON.stringify(r),dataType:"json",headers:{"Content-Type":"application/json"}}).then(function(n){return u.resolve(n.data)},function(n){return console.log(n),u.resolve(!1)}),u.promise}}}]);angular.module("umbraco.resources").factory("shieldResource",["shieldResourceHelper",function(n){var t="backoffice/shield/ShieldApi/";return{deleteEnvironment:function(i){return n.delete(t+"DeleteEnvironment?key="+i)},getApp:function(i){return n.get(t+"GetApp",{key:i})},getEnvironment:function(i){return n.get(t+"GetEnvironment",{key:i})},getEnvironments:function(){return n.get(t+"GetEnvironments")},getJournals:function(i,r,u,f,e){return n.get(t+"Journals",{method:i,id:r,page:u,orderBy:f,orderByDirection:e})},getView:function(i){return n.get(t+"View",{id:i})},postConfiguration:function(i,r){return n.post(t+"WriteConfiguration?key="+i,r)},postEnvironment:function(i){return n.post(t+"WriteEnvironment",i)},setEnvironmentsSortOrder:function(i){return n.post(t+"SortEnvironments",i)}}}]);angular.module("umbraco").controller("Shield.Editors.Overview.Create",["$scope","$location","navigationService",function(n,t,i){var r=this;angular.extend(r,{create:function(){i.hideDialog();t.path("/settings/shield/CreateEnvironment/")}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Delete",["$scope","$route","$location","treeService","navigationService","localizationService","notificationsService","shieldResource",function(n,t,i,r,u,f,e,o){var s=this;angular.extend(s,{busy:!1,currentNode:n.currentNode,performDelete:function(){s.busy||(s.currentNode.loading=!0,s.busy=!0,o.deleteEnvironment(s.currentNode.id).then(function(n){n===!0||n==="true"?(f.localize("Shield.General_DeleteEnvironmentSuccess").then(function(n){e.success(n);s.currentNode.loading=!1;r.removeNode(s.currentNode);i.path()==="/shield"?t.reload():i.path("/shield")}),u.hideMenu()):f.localize("Shield.General_DeleteEnvironmentError").then(function(n){e.error(n)})}))},cancel:function(){u.hideDialog()}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Sort",["$scope","localizationService","notificationsService","shieldResource",function(n,t,i,r){var u=this;angular.extend(u,{loading:!0,sorting:!1,sortingComplete:!1,environments:null,init:function(){r.getEnvironments().then(function(n){u.environments=n;u.environments.splice(u.environments.length-1,1);u.loading=!1})},save:function(){if(!u.sorting){u.sorting=!0;for(var n=0;n<u.environments.length;n++)u.environments[n].sortOrder=n;r.setEnvironmentsSortOrder(u.environments).then(function(n){n===!0||n==="true"?(u.sortingComplete=!0,u.sorting=!1):t.localize("Shield.General_SortEnvironmentError").then(function(n){i.error(n)});u.sorting=!1})}}})}]);
//# sourceMappingURL=Shield.min.js.map