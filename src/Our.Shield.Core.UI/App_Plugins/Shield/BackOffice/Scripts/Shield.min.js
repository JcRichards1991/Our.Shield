angular.module("umbraco").controller("Shield.Controllers.Dashboard",["$scope","dashboardResource","localizationService",function(n,t,i){var r=this;angular.extend(r,{loading:!0,name:"",tabs:[],init:function(){i.localize("sections_Shield").then(function(n){r.name=n});t.getDashboard("Shield").then(function(n){r.tabs=n;r.tabs&&r.tabs.length>0&&(r.tabs[0].active=!0);r.loading=!1})},changeTab:function(n){r.tabs.forEach(function(n){n.active=!1});n.active=!0}})}]);angular.module("umbraco").controller("Shield.Controllers.EnvironmentsDashboard",["$scope","$location","shieldResource",function(n,t,i){var r=this;angular.extend(r,{loading:!0,environments:[],init:function(){i.getEnvironments().then(function(n){r.environments=n.environments;r.loading=!1})},addEnvironment:function(){t.path("/settings/shield/CreateEnvironment")},clickEnvironment:function(n){t.path("/settings/shield/environment/"+n)},sortEnvironments:function(){}})}]);angular.module("umbraco").controller("Shield.Controllers.CreateEnvironment",["$scope","localizationService","notificationsService","shieldResource",function(n,t,i,r){var u=this;angular.extend(u,{loading:!0,navigation:[{name:"Settings",alias:"settings",icon:"icon-settings",view:"/App_Plugins/Shield/BackOffice/Views/EditEnvironment.html?version=2.0.0",active:!0}],button:{label:"Create",labelKey:"actions_create",state:"init"},environment:{icon:"",name:"",domains:[],enabled:!1,continueProcessing:!1},init:function(){r.getEnvironments().then(function(){u.environment.sortOrder=20;u.loading=!1})},save:function(f){if(u.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),f.$invalid){u.button.state="error";angular.element(event.target).addClass("show-validation");t.localize("Shield.General_CreateEnvironmentInvalid").then(function(n){i.error(n)});return}f.$setPristine();r.upsertEnvironment(u.environment).then(function(n){t.localize("Shield.General_CreateEnvironment"+(n.errorCode===0?"Success":"Error")).then(function(t){u.button.state="init";n.errorCode===0?i.success(t):i.error(t)})})}})}]);angular.module("umbraco").controller("Shield.Controllers.ViewEnvironment",["$scope","$routeParams","localizationService","notificationsService","shieldResource",function(n,t,i,r,u){var f=this;angular.extend(f,{environmentKey:t.id,loading:!0,environment:{domains:[]},button:{label:"Save",labelKey:"buttons_save",state:"init"},navigation:[{name:"Apps",alias:"apps",icon:"icon-thumbnail-list",view:"/App_Plugins/Shield/BackOffice/Views/AppListing.html?version=2.0.0",active:!0},{name:"Settings",alias:"settings",icon:"icon-settings",view:"/App_Plugins/Shield/BackOffice/Views/EditEnvironment.html?version=2.0.0",active:!1}],init:function(){u.getEnvironment(f.environmentKey).then(function(n){f.environment=n.environment;f.loading=!1})},save:function(t){if(f.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),t.$invalid){f.button.state="error";angular.element(event.target).addClass("show-validation");i.localize("Shield.General_EditEnvironmentInvalid").then(function(n){r.error(n)});return}t.$setPristine();u.upsertEnvironment(f.environment).then(function(n){i.localize("Shield.General_EditEnvironment"+(n.errorCode===0?"Success":"Error")).then(function(t){f.button.state="init";n.errorCode===0?r.success(t):r.error(t)})})}})}]);angular.module("umbraco").controller("Shield.Controllers.EnvironmentAppsListing",["$scope","$routeParams","$location","shieldResource",function(n,t,i,r){var u=this;angular.extend(u,{environmentKey:t.id,editing:t.edit==="true",loading:!0,apps:[],init:function(){r.getEnvironmentApps(u.environmentKey).then(function(n){u.apps=n.apps;u.loading=!1})},appClick:function(n){i.path("/settings/shield/app/"+n)},getAppNameKey:function(n){return"Shield."+n+"_Name"},getAppDescriptionKey:function(n){return"Shield."+n+"_Description"}})}]);angular.module("umbraco").controller("Shield.Controllers.AppEdit",["$scope","$routeParams","notificationsService","localizationService","shieldResource",function(n,t,i,r,u){var f=this;angular.extend(f,{appKey:t.id,state:{loading:!0},button:{label:"Update",labelKey:"general_update",state:"init"},app:null,config:null,tabs:[],environmentKey:"",name:"",description:"",init:function(){u.getApp(f.appKey).then(function(n){f.app=n.app;f.config=n.configuration;f.tabs=n.tabs;f.environmentKey=n.environmentKey;r.localize("Shield."+f.app.id+"_Name").then(function(n){f.name=n;r.localize("Shield."+f.app.id+"_Description").then(function(n){f.description=n;f.state.loading=!1})})})},save:function(){if(f.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),n.appForm.$invalid){angular.element(event.target).addClass("show-validation");r.localize("Shield.General_SaveConfigurationInvalid").then(function(n){i.error(n)});f.button.state="error";return}n.appForm.$setPristine();u.postConfiguration(f.app.id,f.appKey,f.config,f.environmentKey).then(function(n){n.errorCode===0?(r.localize("Shield.General_SaveConfigurationSuccess").then(function(n){i.success(n)}),f.button.state="init"):(r.localize("Shield.General_SaveConfigurationError").then(function(n){i.error(n)}),f.button.state="error")})}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Create",["$scope","$location","navigationService",function(n,t,i){var r=this;angular.extend(r,{create:function(){i.hideDialog();t.path("/settings/shield/CreateEnvironment/")}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Delete",["$scope","$route","$location","treeService","navigationService","localizationService","notificationsService","shieldResource",function(n,t,i,r,u,f,e,o){var s=this;angular.extend(s,{busy:!1,currentNode:n.currentNode,performDelete:function(){s.busy||(s.currentNode.loading=!0,s.busy=!0,o.deleteEnvironment(s.currentNode.id).then(function(n){n.successful===!0&&n.errorCode===0?(f.localize("Shield.General_DeleteEnvironmentSuccess").then(function(n){e.success(n);s.currentNode.loading=!1;r.removeNode(s.currentNode);i.path("/settings/shield/Dashboard")}),u.hideMenu()):f.localize("Shield.General_DeleteEnvironmentError").then(function(n){e.error(n)})}))},cancel:function(){u.hideDialog()}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Sort",["$scope","localizationService","notificationsService","shieldResource",function(n,t,i,r){var u=this;angular.extend(u,{loading:!0,environments:[],button:{state:"init"},init:function(){r.getEnvironments().then(function(n){angular.forEach(n.environments,function(n){n.key!="705b8967-070e-44c8-805d-57e0f46af779"&&u.environments.push(n)});u.loading=!1})},save:function(){u.loading=!0;u.button.state="busy";for(var n=0;n<u.environments.length;n++)u.environments[n].sortOrder=n;r.setEnvironmentsSortOrder(u.environments).then(function(n){n.errorCode!==0?t.localize("Shield.General_SortEnvironmentError").then(function(n){i.error(n);u.button.state="error";u.loading=!1}):(u.button.state="init",u.loading=!1)})}})}]);angular.module("umbraco.directives").directive("shieldApp",["$compile","$templateCache","$http",function(n,t,i){return{restrict:"E",scope:{view:"=",configuration:"="},link:function(r,u){if(r.view){var f=t.get(r.view);f?(u.html(f),n(u.contents())(r)):i.get(r.view).then(function(i){t.put(r.view,i.data);u.html(i.data);n(u.contents())(r)})}}}}]);angular.module("umbraco.directives").directive("shieldConvertToNumber",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){return parseInt(n,10)});r.$formatters.push(function(n){return""+n})}}}]);angular.module("umbraco.directives").directive("shieldAddToForm",[function(){return{restrict:"A",require:["ngModel","^form"],link:function(n,t,i,r){var u=r[0],f=r[1];f.$removeControl(u);u.$name=i.name;f.$addControl(u)}}}]);angular.module("umbraco.directives").directive("shieldIpaddressvalid",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){if(n===""||n===undefined)return r.$setValidity("shieldIpaddressvalid",!0),n;return r.$setValidity("shieldIpaddressvalid",/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(n)),n})}}}]);angular.module("umbraco.directives").directive("shieldIpAccessControl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/IpAccessControl.html",scope:{ipAccessControl:"="},controller:["$scope","localizationService","editorService",function(n,t,i){angular.extend(n,{openDialog:function(t){var r;r=t===-1?{fromIpAddress:"",toIpAddress:"",description:"",ipAddressType:0}:angular.copy(n.ipAccessControl.ipAccessRules[t]);i.open({view:"../App_Plugins/Shield/Backoffice/Views/Dialogs/EditIpAccessRule.html",size:"small",ipAccessRule:r,submit:function(){t===-1?n.ipAccessControl.ipAccessRules.push(r):n.ipAccessControl.ipAccessRules[t]=r;i.close()},close:function(){i.close()}})},remove:function(i){var r=n.ipAccessControl.ipAccessRules[i],u;r.value!==""?(u=r.value,r.description!==""&&(u+=" - "+r.description),t.localize("Shield.Properties.IpAccessControl.Messages_ConfirmRemoveIp").then(function(t){confirm(t+u)&&n.ipAccessControl.ipAccessRules.splice(i,1)})):n.ipAccessControl.ipAccessRules.splice(i,1)}})}]}}]);angular.module("umbraco.directives").directive("shieldTransferUrlControl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/TransferUrlControl.html",scope:{transferUrlControl:"="},link:function(n){n.transferUrlControl.url===null&&(n.transferUrlControl.url={type:0,value:""});switch(n.transferUrlControl.url.type){case 0:n.transferUrlControl.url.urlValue=n.transferUrlControl.url.value;break;case 1:n.transferUrlControl.url.xpathValue=n.transferUrlControl.url.value;break;case 2:n.transferUrlControl.url.mntpValue=n.transferUrlControl.url.value||""}angular.extend(n,{contentPickerProperty:{view:"contentpicker",alias:"contentPicker",currentNode:{path:"-1"},config:{multiPicker:"0",entityType:"Document",startNode:{query:"",type:"content",id:"-1"},filter:"",minNumber:1,maxNumber:1},value:n.transferUrlControl.url.mntpValue}});n.$on("formSubmitting",function(){switch(n.transferUrlControl.url.type){case 0:n.transferUrlControl.url.value=n.transferUrlControl.url.urlValue;break;case 1:n.transferUrlControl.url.value=n.transferUrlControl.url.xpathValue;break;case 2:n.transferUrlControl.url.value=n.contentPickerProperty.url.mntpValue}})}}}]);angular.module("umbraco.resources").factory("shieldResourceHelper",["$http","$q",function(n,t){return{"delete":function(i){if(!i)throw Error("url is required");var r=t.defer();return n({method:"DELETE",url:i,headers:{"Content-Type":"application/json"}}).then(function(n){return r.resolve(n.data)},function(n){return console.log(n),r.resolve(!1)}),r.promise},get:function(i,r){if(!i)throw Error("url is required");var u=t.defer();return r=r||{},n.get(i,{params:r}).then(function(n){return u.resolve(n.data)},function(n){return console.log(n),u.resolve(!1)}),u.promise},post:function(i,r){if(!i)throw Error("url is required");if(!r)throw Error("data is required");var u=t.defer();return n({method:"POST",url:i,data:JSON.stringify(r),dataType:"json",contentType:"application/json"}).then(function(n){return u.resolve(n.data)},function(n){return console.log(n),u.resolve(!1)}),u.promise}}}]);angular.module("umbraco.resources").factory("shieldResource",["shieldResourceHelper",function(n){var t="backoffice/shield/ShieldApi/";return{deleteEnvironment:function(i){return n.delete(t+"DeleteEnvironment?key="+i)},getApp:function(i){return n.get(t+"GetApp",{key:i})},getEnvironment:function(i){return n.get(t+"GetEnvironment",{key:i})},getEnvironments:function(){return n.get(t+"GetEnvironments")},getEnvironmentApps:function(i){return n.get(t+"GetEnvironmentApps",{environmentKey:i})},getView:function(i){return n.get(t+"View",{id:i})},postConfiguration:function(i,r,u,f){return n.post(t+"UpdateAppConfiguration",{appId:i,key:r,environmentKey:f,configuration:u})},setEnvironmentsSortOrder:function(i){return n.post(t+"SortEnvironments",{environments:i})},upsertEnvironment:function(i){return n.post(t+"UpsertEnvironment",i)}}}]);
//# sourceMappingURL=Shield.min.js.map