angular.module("umbraco").controller("Shield.Dashboards.Environments",["$scope","$location","shieldResource",function(n,t,i){var r=this;angular.extend(r,{loading:!0,Description:"",Environments:[],init:function(){i.getView("0").then(function(n){r.description=n.data.description;r.environments=n.data.environments;r.loading=!1})},editItem:function(n){t.path("/shield/shield/edit/"+n.id)}})}]);angular.module("umbraco").controller("Shield.Dashboards.Journal",["$scope","$routeParams","$location","listViewHelper","shieldResource",function(n,t,i,r,u){var f=this;angular.extend(f,{id:t.id,loading:!0,items:[],totalPages:1,pageNumber:1,type:null,options:{orderBy:"datestamp",orderDirection:"desc"},columns:[{id:0,name:"Date",alias:"datestamp",allowSorting:!0,show:!0},{id:1,name:"Environment",alias:"environment",allowSorting:!0,show:!0},{id:2,name:"App",alias:"app",allowSorting:!1,show:!0},{id:3,name:"Message",alias:"message",allowSorting:!1,show:!0}],init:function(){f.id===undefined&&(f.id=null);f.getListing()},editItem:function(n){i.path("/shield/shield/edit/"+n.id)},nextPage:function(n){f.pageNumber=n;f.getListing()},previousPage:function(n){f.pageNumber=n;f.getListing()},gotoPage:function(n){f.pageNumber=n;f.getListing()},isSortDirection:function(n,t){return r.setSortingDirection(n,t,f.options)},sort:function(n){f.options.orderBySystemField=!1;r.setSorting(n,allow,f.options);f.getListing()},getListing:function(){f.loading=!0;u.getJournals(f.id,f.pageNumber,f.options.orderBy,f.options.orderDirection).then(function(n){f.items=n.data.items;f.totalPages=n.data.totalPages;f.type=n.data.type;f.loading=!1})}})}]);angular.module("umbraco").controller("Shield.Editors.Dialogs.EditException",["$scope",function(n){var t=this;angular.extend(t,{exception:n.dialogData,buttonKey:"",init:function(){t.buttonKey="general_"+(t.exception.fromIpAddress===""?"add":"update")},close:n.close,submit:function(){n.submit(t.exception)}})}]);angular.module("umbraco.directives").directive("shieldApp",["$compile","$templateCache","$http",function(n,t,i){return{restrict:"E",scope:{view:"=",configuration:"="},link:function(r,u){if(r.view){var f=t.get(r.view);f?(u.html(f),n(u.contents())(r)):i.get(r.view).then(function(i){t.put(r.view,i.data);u.html(i.data);n(u.contents())(r)})}}}}]);angular.module("umbraco.directives").directive("shieldConvertToNumber",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){return parseInt(n,10)});r.$formatters.push(function(n){return""+n})}}}]);angular.module("umbraco.directives").directive("shieldAddToForm",[function(){return{restrict:"A",require:["ngModel","^form"],link:function(n,t,i,r){var u=r[0],f=r[1];f.$removeControl(u);u.$name=i.name;f.$addControl(u)}}}]);angular.module("umbraco.directives").directive("shieldIpddressvalid",[function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){if(n===""||n===undefined)return r.$setValidity("shieldIpaddressvalid",!0),n;return r.$setValidity("shieldIpaddressvalid",/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(n)),n})}}}]);angular.module("umbraco.directives").directive("shieldIpAccessControl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/IpAccessControl.html",scope:{model:"="}}}]);angular.module("umbraco.directives").directive("shieldIpAccessControlRanges",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/IpAccessControlRanges.html",scope:{exceptions:"="},controller:["$scope","localizationService","dialogService",function(n,t,i){angular.extend(n,{add:function(){n.openDialog(-1)},edit:function(t){n.openDialog(t)},openDialog:function(t){var r;r=t===-1?{fromIpAddress:"",toIpAddress:"",description:"",ipAddressType:0}:angular.copy(n.exceptions[t]);i.open({template:"../App_Plugins/Shield/Backoffice/Views/Dialogs/EditIpException.html",dialogData:r,callback:function(i){t===-1?n.exceptions.push(i):n.exceptions[t]=i}})},remove:function(i){var r=n.exceptions[i],u;r.value!==""?(u=r.value,r.description!==""&&(u+=" - "+r.description),t.localize("Shield.Properties.IpAccessControl.Messages_ConfirmRemoveIp").then(function(t){confirm(t+u)&&n.exceptions.splice(i,1)})):n.exceptions.splice(i,1)}})}]}}]);angular.module("umbraco.directives").directive("shieldUmbracoUrl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/UmbracoUrl.html",scope:{model:"="},link:function(n){angular.extend(n.model,{contentPickerProperty:{view:"contentpicker",alias:"contentPicker",config:{multiPicker:"0",entityType:"Document",startNode:{query:"",type:"content",id:-1},filter:"",minNumber:1,maxNumber:1},value:n.model.value}});n.$watch("model.contentPickerProperty.value",function(t){n.model.value=t})}}}]);angular.module("umbraco.directives").directive("shieldTransferUrl",[function(){return{restrict:"E",templateUrl:"/App_Plugins/Shield/Backoffice/Views/Directives/TransferUrl.html?version=1.0.6",scope:{model:"="}}}]);angular.module("umbraco").controller("Shield.Editors.Edit",["$scope","$routeParams","$location","$timeout","$route","notificationsService","localizationService","navigationService","shieldResource",function(n,t,i,r,u,f,e,o,s){var h=this;angular.extend(h,{type:null,id:t.id,editingEnvironment:t.edit==="true"||t.id==="-100",name:"",description:"",loading:!0,environments:[],environment:null,app:null,appView:null,configuration:null,path:[],ancestors:null,apps:[],tabs:[],button:{label:"Update",labelKey:"general_update",state:"init"},init:function(){s.getView(h.id).then(function(n){h.environments=n.data.environments;h.environment=n.data.environment;h.description=n.data.description;h.name=n.data.name;switch(h.type=n.data.type){case 1:h.id==="-100"?(h.environment.sortOrder=h.environments.length===1?0:h.environments[h.environments.length-2].sortOrder+1,h.button.labelKey="general_create",e.localize(h.button.labelKey).then(function(n){h.button.label=n;h.loading=!1})):h.id==="1"&&h.editingEnvironment?h.cancelEditing():(h.path=["-1",h.id],h.ancestors=[{id:h.id,name:h.name}],h.apps=n.data.apps,h.tabs=[{id:"0",label:"Apps",view:"/App_Plugins/Shield/Backoffice/Views/Environment.html?version=1.0.6",active:!0},{id:"1",label:"Settings",view:"/App_Plugins/Shield/Backoffice/Views/EditEnvironment.html?version=1.0.6",active:!1},{id:"2",label:"Journal",view:"/App_Plugins/Shield/Backoffice/Dashboards/Journal.html?version=1.0.6",active:!1}]);h.id!=="1"&&(h.environment.domains===null||h.environment.domains.length===0)&&(h.environment.domains=[{id:0,name:"",umbracoDomainId:null,environmentId:h.environment.id}]);break;case 2:h.path=["-1",""+h.environment.id,h.id];h.ancestors=[{id:h.environment.id,name:h.environment.name},{id:h.id,name:h.name}];h.app=n.data.app;h.appView=n.data.appView;h.configuration=n.data.configuration;h.tabs=n.data.tabs}r(function(){o.syncTree({tree:"shield",path:h.path,forceReload:!0,activate:!0});h.loading=!1})})},editItem:function(n){i.path("/shield/shield/edit/"+n.id)},editEnvironment:function(){i.search("edit","true")},cancelEditing:function(){i.search("edit","false");h.id==="-100"&&i.path("/shield")},save:function(){if(h.button.state="busy",n.$broadcast("formSubmitting",{scope:n,action:"publish"}),n.shieldForm.$invalid){angular.element(event.target).addClass("show-validation");var t="";switch(h.type){case 1:t=h.id==="-100"?"CreateEnvironmentInvalid":"SaveEnvironmentInvalid";break;case 2:t="SaveConfigurationInvalid"}e.localize("Shield.General_"+t).then(function(n){f.error(n)});h.button.state="error";return}n.shieldForm.$setPristine();switch(h.type){case 1:s.postEnvironment(h.environment).then(function(n){var t,s,r;n.data===!0||n.data==="true"?(t="SaveEnvironmentSuccess",h.id==="-100"&&(t="CreateEnvironmentSuccess"),e.localize("Shield.General_"+t).then(function(n){f.success(n)}),h.cancelEditing(),h.id==="-100"?(s=["-1","-21"],o.syncTree({tree:"shield",path:s,forceReload:!0,activate:!0}),i.path("/shield")):u.reload()):(r="SaveEnvironmentError",h.id==="-100"&&(r="CreateEnvironmentError"),e.localize("Shield.General_"+r).then(function(n){f.error(n)}),h.button.state="error")});break;case 2:s.postConfiguration(h.id,h.configuration).then(function(n){n.data===!0||n.data==="true"?(e.localize("Shield.General_SaveConfigurationSuccess").then(function(n){f.success(n)}),o.syncTree({tree:"shield",path:h.path,forceReload:!0,activate:!0}),u.reload()):(e.localize("Shield.General_SaveConfigurationError").then(function(n){f.error(n)}),h.button.state="error")})}}})}]);angular.module("umbraco.resources").factory("shieldResource",["$http","$q",function(n,t){var u="backoffice/Shield/ShieldApi/",r=function(i,r){var f=t.defer();return r=r||{},n.get(u+i,{params:r}).then(function(n){return f.resolve(n.data)},function(n){return f.resolve(n)}),f.promise},i=function(i,r){var f=t.defer();return n({method:"POST",url:u+i,data:JSON.stringify(r),dataType:"json",headers:{"Content-Type":"application/json"}}).then(function(n){return f.resolve(n.data)},function(n){return f.resolve(n)}),f.promise};return{deleteEnvironment:function(n){return i("DeleteEnvironment",{id:n})},getEnvironments:function(){return r("GetEnvironments")},getJournals:function(n,t,i,u){return r("Journals",{id:n,page:t,orderBy:i,orderByDirection:u})},getView:function(n){return r("View",{id:n})},postConfiguration:function(n,t){return t.id=n,i("WriteConfiguration",t)},postEnvironment:function(n){return i("WriteEnvironment",n)},setEnvironmentsSortOrder:function(n){return i("SortEnvironments",n)}}}]);angular.module("umbraco").controller("Shield.Editors.Overview.Create",["$scope","$location","navigationService",function(n,t,i){var r=this;angular.extend(r,{create:function(){i.hideDialog();t.path("/shield/shield/edit/-100")}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Delete",["$scope","$routeParams","$route","$location","treeService","navigationService","localizationService","notificationsService","shieldResource",function(n,t,i,r,u,f,e,o,s){var h=this;angular.extend(h,{busy:!1,currentNode:n.currentNode,performDelete:function(){h.busy||(h.currentNode.loading=!0,h.busy=!0,s.deleteEnvironment(h.currentNode.id).then(function(n){n.data===!0||n.data==="true"?(e.localize("Shield.General_DeleteEnvironmentSuccess").then(function(n){o.success(n);h.currentNode.loading=!1;u.removeNode(h.currentNode);r.path()==="/shield"?i.reload():r.path("/shield")}),f.hideMenu()):e.localize("Shield.General_DeleteEnvironmentError").then(function(n){o.error(n)})}))},cancel:function(){f.hideDialog()}})}]);angular.module("umbraco").controller("Shield.Editors.Overview.Sort",["$scope","localizationService","notificationsService","shieldResource",function(n,t,i,r){var u=this;angular.extend(u,{loading:!0,sorting:!1,sortingComplete:!1,environments:null,init:function(){r.getEnvironments().then(function(n){u.environments=n.data;u.environments.splice(u.environments.length-1,1);u.loading=!1})},save:function(){u.sorting=!0;for(var n=0;n<u.environments.length;n++)u.environments[n].sortOrder=n;r.setEnvironmentsSortOrder(u.environments).then(function(n){n.data===!0||n.data==="true"?u.sortingComplete=!0:t.localize("Shield.General_SortEnvironmentError").then(function(n){i.error(n)});u.sorting=!1})}})}]);
//# sourceMappingURL=Shield.min.js.map